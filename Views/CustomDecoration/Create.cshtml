@model EventBooking.Models.CustomDecoration

@{
    ViewData["Title"] = Model.DecorationId == 0 ? "Add Decoration" : "Edit Decoration";
    Layout = "_Layout";
}

<div class="container my-5">
    <div class="card shadow-sm">
        <div class="card-header bg-primary text-white">
            <h4 class="mb-0">@ViewData["Title"]</h4>
        </div>

        <div class="card-body">
            @using (Html.BeginForm("Create", "CustomDecoration", FormMethod.Post, new { enctype = "multipart/form-data" }))
            {
                @Html.AntiForgeryToken()
                @Html.HiddenFor(m => m.DecorationId)

                <div class="mb-3">
                    @Html.LabelFor(m => m.Name, new { @class = "form-label" })
                    @Html.TextBoxFor(m => m.Name, new { @class = "form-control", placeholder = "Decoration Name" })
                    @Html.ValidationMessageFor(m => m.Name, "", new { @class = "text-danger" })
                </div>

                <div class="mb-3">
                    @Html.LabelFor(m => m.Description, new { @class = "form-label" })
                    @Html.TextAreaFor(m => m.Description, new { @class = "form-control", rows = 4, placeholder = "Enter description" })
                    @Html.ValidationMessageFor(m => m.Description, "", new { @class = "text-danger" })
                </div>

                <div class="mb-3">
                    <label class="form-label">Upload Image</label>
                    <input type="file" name="ImageFile" class="form-control" accept="image/*" onchange="previewImage(event)" />
                    <small class="text-muted">Allowed formats: JPG, PNG, GIF | Max size: 5MB</small>
                    @Html.ValidationMessage("ImageFile", "", new { @class = "text-danger" })
                </div>

                @* Existing image preview (Edit mode) *@
                @if (!string.IsNullOrEmpty(Model.ImageUrl))
                {
                    <div class="mb-3">
                        <label class="form-label">Current Image</label><br />
                        <img src="@Url.Content(Model.ImageUrl)" class="img-thumbnail" style="max-height: 200px;" />
                    </div>
                }

                @* Client-side preview on image select *@
                <div class="mb-3" id="previewContainer" style="display:none;">
                    <label class="form-label">Preview</label><br />
                    <img id="imagePreview" class="img-thumbnail" style="max-height: 200px;" />
                </div>

                <div class="d-flex justify-content-between">
                    <button type="submit" class="btn btn-success rounded-pill">
                        @(Model.DecorationId == 0 ? "Add Decoration" : "Update Decoration")
                    </button>
                    <a asp-action="Index" class="btn btn-outline-secondary rounded-pill">Cancel</a>
                </div>
            }
        </div>
    </div>
</div>

@section Scripts {
    <script>
        function previewImage(event) {
            var preview = document.getElementById('imagePreview');
            var container = document.getElementById('previewContainer');
            var file = event.target.files[0];

            if (file) {
                var reader = new FileReader();
                reader.onload = function (e) {
                    preview.src = e.target.result;
                    container.style.display = 'block';
                };
                reader.readAsDataURL(file);
            }
        }
    </script>
}

<style>
    .form-label {
        font-weight: 600;
    }

    .img-thumbnail {
        border: 1px solid #ddd;
        max-height: 200px;
    }

    .btn {
        min-width: 130px;
    }
</style>
